@model Pardisan.ViewModels.Estate.UpsertEstateVM

@{
    ViewData["Title"] = "جزئیات پروژه";
}

@section styles{
    <link href="//static.neshan.org/sdk/leaflet/1.4.0/leaflet.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnify/dist/jquery.magnify.css">
    <link href="~/lib/magnific-popup.css" rel="stylesheet" />
    <style>
        .shadow-effect {
            box-shadow: 0 0 25px 10px rgba(0, 0, 0, 0.2)
        }

        #map div {
            z-index: 1 !important;
        }

        .leaflet-container {
            cursor: crosshair;
        }

        .zoom-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            visibility: hidden;
        }

        .zoomed-image {
            display: block;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
}







<section class="container-fuid p-4 ">
    <div class="row">
        <div class="col-lg-5 mb-3 order-1 order-lg-0">
            <div class="portfolio-info">
                <div class="d-flex flex-row mb-lg-2 mb-3">
                    <div class="Dottedstocol ml-3"></div>
                    <div class="singletitle">
                        <span>عنوان پروژه</span>
                        <h1 class="text-right">@Model.Title</h1>
                    </div>
                </div>
                <input value="@Model?.Id" id="id-edit-building" type="hidden" />
                <div class="col-12" style="max-width: 80%; right: -30px;">
                    @if (string.IsNullOrWhiteSpace(Model.AparatLink))
                    {
                        <img src="~/img/Engineers.jpg" class="radius20 mb-4 d-none d-md-block" />
                    }
                    @Html.Raw(Model.AparatLink)
                </div>
                <h5 class="mb-0" style="font-weight: 600">اطلاعات</h5>
                <div class="row">
                   
                    <div class="col-6 px-1">
                        <p class="fs-7"><i class="fal fa-home ml-2" style="width: 30px"></i><span style="font-size: 11px;">تعداد طبقات : </span><span style="font-size: 11px;">@Model.FloorCount</span></p>
                    </div>
                    <div class="col-6 px-1">
                        <p class="fs-7"><i class="fal fa-chart-bar ml-2" style="width: 30px"></i><span style="font-size: 11px;">متراژ واحدها : </span><span style="font-size: 11px;">@Model.EstateMeterage</span></p>
                    </div>
                    <div class="col-6 px-1">
                        <p class="fs-7"><i class="fal fa-chart-area ml-2" style="width: 30px"></i><span style="font-size: 11px;">تعداد واحد در طبقه  : </span><span style="font-size: 11px;">@Model.UnitInFlorCount</span></p>
                    </div>
                    <div class="col-6 px-1">
                        <p class="fs-7"><i class="fal fa-chart-scatter ml-2" style="width: 30px"></i><span style="font-size: 11px;">تعداد کل واحد ها: </span><span style="font-size: 11px;">@Model.TotalUnits</span></p>
                    </div>


                    <div class="col-6 px-1">
                        <p class="fs-7"><i class="fal fa-user ml-2" style="width: 30px"></i><span style="font-size: 11px;">نوع کاربری : </span><span style="font-size: 11px;">@Model.UsageType</span></p>
                    </div>
                    @if (Model.Status != 0)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7"><i class="fal fa-calendar ml-2" style="width: 30px"></i><span style="font-size: 11px;">تاریخ شروع : </span><span style="font-size: 11px;">@Model.StartDateForShow</span></p>
                        </div>
                    }



                    <div class="col-6 px-1">
                        <p class="fs-7"><i class="fal fa-info ml-2" style="width: 30px"></i><span style="font-size: 11px;">وضعیت پروژه : </span><span style="font-size: 11px;">@(Model.Status == 0 ? "تکمیل شده" : "جاری")</span></p>
                    </div>
                </div>
                <h5 class="mb-0 mt-3" style="font-weight: 600">آپشن ها</h5>
                <div class="row">
                    @if (Model.AbNama == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-solid fa-water fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>آبنمای مدرن </span>
                            </p>
                        </div>
                    } @if (Model.Flower == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-solid fa-flower fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>گل آرایی </span>
                            </p>
                        </div>
                    }
                    @if (Model.Fibr == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-solid fa-network-wired fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>اجرای فیبر نوری </span>
                            </p>
                        </div>
                    }
                    @if (Model.QRCode == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-solid fa-qrcode fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>QRcode</span>
                            </p>
                        </div>
                    }
                    @if (Model.Camera == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-solid fa-camera fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>دوربین مدار بسته</span>
                            </p>
                        </div>
                    }
                    @if (Model.Security == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-sign-in fa-camera fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>سیستم امنیتی کد ورود</span>
                            </p>
                        </div>
                    }
                    @if (Model.Shomineh == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-fireplace fa-camera fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>شومینه برقی</span>
                            </p>
                        </div>
                    }
                    @if (Model.Alachigh == true)
                    {
                        <div class="col-6 px-1">
                            <p class="fs-7">
                                <i class="fal fa-home fa-camera fa-shake  ml-2" style="width: 30px;color: #CCC;background:rgba(0,0,0,0.8)"></i>
                                <span>آلاچیق</span>
                            </p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="row">
                        <div class="col-lg-12 w-100">

                            <div class="swiper-container w-100 h-100" style="overflow: hidden">
                                <div class="swiper-wrapper w-100 h-100">
                                    @foreach (var i in Model.GalleryIameges.Images)
                                    {
                                        int index = Model.GalleryIameges.Images.IndexOf(i);
                                        <div class="swiper-slide w-100 d-flex align-items-center justify-content-center" data-id="@i">
                                            <img id="@i" src="https://api.pardisan-mc.com@(i)" />
                                        </div>

                                    }
                                </div>
                                <div class="swiper-scrollbar"></div>
                                <div class="swiper-button-prev"></div>
                                <div class="swiper-button-next"></div>
                            </div>
                        </div>
                        @*          <div class="col-lg-4">
                        <div class="row mt-2 image-click-list">
                        @foreach (var i in Model.GalleryIameges.Images)
                        {

                        int index = Model.GalleryIameges.Images.IndexOf(i);

                        <div class="col-6" style="cursor: pointer" data-id="@i.Id">
                        <img id="@i.Id" src="@i.Url" class="mb-3 img-fluid" style="border-radius: 8px" />

                        </div>
                        }
                        </div>
                        </div>*@
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div class="col-lg-7 mb-3 pr-3 order-0 order-lg-1">
            <div class="singletitle">
                <span>گالری تصاویر</span>
            </div>
            <div class="row">
                <div class="col-lg-2">
                    <div class="w-100 image-project-list">

                        @foreach (var i in Model.GalleryIameges.Images)
                        {
                            <a class="image-popup" href="@i" style="cursor: pointer">
                                <img style="width: 120px; height: 90px; border-radius: 15px" alt="Image cap [110%x180]" src="https://api.pardisan-mc.com@(i)" class="py-2 radius15">
                            </a>

                        }
                    </div>
                </div>
                <div class="col-lg-10" style="cursor: pointer">
                    <div style="overflow: hidden">
                        <img src="https://api.pardisan-mc.com@(Model.Image)" class="py-2 w-100" style="transition: all 0.3s; border-radius: 15px;" id="big-image" />
                    </div>
                </div>
            </div>

            @*<img src="~/img/Lotus-M-G-7.jpg" class="py-3 radius15 w-800" />*@

        </div>
    </div>
    <div class="row my-3">
        @if (Model.Description != null)
        {
            <div class="col-lg-12">

                <h3 class="IRANSans_Bold mb-2">توضیحات پروژه</h3>
                <div class="line_bottom"></div>
                <p class="text-justify">

                    @Html.Raw(Model.Description)
                </p>

            </div>
        }
        <div class="col-lg-4 form-group my-3">
            <div class="building w-100 position-relative" dir="ltr">
                <img src="https://clipart-library.com/image_gallery/223359.png" id="image-roof" class=" mb-1 w-100" style="height: 100px; display: none" />
                <div class="info-building" id="info-roof" style="position: absolute;top: 40px; left: 35%; display: none">
                    <div class="d-flex align-items-center">
                        <div class="mx-2" style="height:15px;width:15px; background-color: lawngreen;opacity: 0.3;"></div>

                        <p class="mb-0">واحد های موجود</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="mx-2" style="height:15px;width:15px; background-color: rgba(255,192,203, 0.5);"></div>

                        <p>واحد های فروخته شده</p>
                    </div>
                </div>
                <div id="floors" class="floors"></div>
            </div>
        </div>
@*        @{
            var yourStyle = "";
            if (Model.Floors.Count() == 3)
            {
                yourStyle = "height: 300px !important;";
            }
            else if (Model.Floors.Count() == 0)
            {
                yourStyle = "height: 400px";
                //any other conditions and logic
            }
            else if (Model.Floors.Count() == 4)
            {
                yourStyle = "height: 270px";
                //any other conditions and logic
            }
            else if (Model.Floors.Count() == 5)
            {
                yourStyle = "height: 330px";

            }
            else if (Model.Floors.Count() == 6)
            {
                yourStyle = "height: 370px";

            }
            else if (Model.Floors.Count() == 7)
            {
                yourStyle = "height: 420px";

            }
            else if (Model.Floors.Count() == 8)
            {
                yourStyle = "height: 475px";

            }
            else if (Model.Floors.Count() == 9)
            {
                yourStyle = "height: 530px";

            }
            else if (Model.Floors.Count() == 10)
            {
                yourStyle = "height: 570px";

            }
            else if (Model.Floors.Count() == 11)
            {
                yourStyle = "height: 630px";

            }
            else if (Model.Floors.Count() == 12)
            {
                yourStyle = "height: 670px";

            }
            else
            {
                yourStyle = "height: 300px";

            }
        }*@
       @* @if (Model.Lat != 0)
        {
            <div class="col-lg-8  form-group my-3 px-4">
                <label class="fw-bold fs-6">موقعیت مکانی</label>
                <label class="text-danger mr-1">*</label>
                <div id="map" class="" style="@yourStyle"></div>
                <input type="hidden" asp-for="Lat" />
                <input type="hidden" asp-for="Long" />
                <span class="text-muted"></span>
            </div>
        }*@

    </div>

    </div>
    @* <label class="fw-bold fs-6">موقعیت مکانی</label>
    <div id="map" class="h-300px"></div>
    <input type="hidden" asp-for="Lat" />
    <input type="hidden" asp-for="Long" />*@
    @*<div class="row pt-3">
    <div class="col-lg-12">

    <h3 class="IRANSans_Bold mb-2">سایر تصاویر پروژه</h3>
    <div class="line_bottom"></div>
    <div class="d-flex flex-md-row flex-column  my-xl-0 my-4 float-xl-left copic popup-gallery">
    <a href="~/img/other-pic.jpg" class="grid m-2">
    <figure class="effect-ruby radius10">
    <img src="~/img/other-pic.jpg" alt="img01" class="radius10 img-fluid">
    </figure>
    </a>
    <a href="~/img/Lotus-M-G-5.jpg" class="grid m-2">
    <figure class="effect-ruby radius10">
    <img src="~/img/Lotus-M-G-5.jpg" alt="img01" class="radius10 img-fluid">
    </figure>
    </a>
    <a href="~/img/other-pic3.jpg" class="grid m-2">
    <figure class="effect-ruby radius10">
    <img src="~/img/other-pic3.jpg" alt="img01" class="radius10 img-fluid">
    </figure>
    </a>
    <a href="~/img/other-pic4.jpg" class="grid m-2">
    <figure class="effect-ruby radius10">
    <img src="~/img/other-pic4.jpg" alt="img01" class="radius10 img-fluid">
    </figure>
    </a>

    </div>

    </div>
    </div>*@
</section>
@section scripts{
    <script src="~/lib/jquery.magnific-popup.min.js"></script>
    <script src="//static.neshan.org/sdk/leaflet/1.4.0/leaflet.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/magnify/dist/jquery.magnify.js"></script>

    <script>


        const selections = [];
        var setUnitId = null;
        var isMerg = false;
        var isUnitStyle = false;

        const getMergedUnitDirection = (unit) => {
            const currentFloorNumber = unit?.floorNumber;
            const currentUnitIndex = selections[currentFloorNumber - 1]?.estateUnits?.findIndex(
                (u) => u.id === unit.id
            );

            if (
                currentUnitIndex > 0 &&
                selections[currentFloorNumber - 1]?.estateUnits[currentUnitIndex - 1]
                    ?.mergedUnitId === unit.id
            ) {
                return "left";
            }

            if (
                currentUnitIndex < selections[currentFloorNumber - 1]?.estateUnits?.length - 1 &&
                selections[currentFloorNumber - 1]?.estateUnits[currentUnitIndex + 1]
                    ?.mergedUnitId === unit.id
            ) {
                return "right";
            }

            const topFloor = selections[currentFloorNumber - 2];
            const bottomFloor = selections[currentFloorNumber];

            if (
                topFloor &&
                topFloor.estateUnits.length ===
                selections[currentFloorNumber - 1]?.estateUnits.length &&
                topFloor.estateUnits[currentUnitIndex]?.mergedUnitId === unit.id
            ) {
                return "top";
            }

            if (
                bottomFloor &&
                bottomFloor.estateUnits.length ===
                selections[currentFloorNumber - 1]?.estateUnits.length &&
                bottomFloor.estateUnits[currentUnitIndex]?.mergedUnitId === unit.id
            ) {
                return "bottom";
            }

            return "none";
        };
        function getTextUnitStyle(unit) {
            const mergedUnitId = unit.mergedUnitId;
            const mergedUnit = selections
                .flatMap((floor) => floor.estateUnits)
                .find((u) => u.id === mergedUnitId);
            let style = "";

            //if (mergedUnit) {
            //    const mergedUnitDirection = getMergedUnitDirection(mergedUnit);

            //    if (mergedUnitDirection === "bottom") {

            //        style += "transform: translateY(40px)";
            //    } else if (mergedUnitDirection === "top") {

            //                            style += "transform: translateY(20px)";

            //    } else if (mergedUnitDirection === "right") {
            //        style += "border-top: 1px solid #000;";

            //        style += "margin: 5px 5px 5px 0px;";
            //    } else if (mergedUnitDirection === "left") {

            //        style += "margin: 5px 0px 5px 5px;";
            //    } else {
            //        style = "none;";
            //    }
            //    return style;
            //}

            if (getMergedUnitDirection(unit) === "bottom") {

                style += "transform: translateY(-20px);";
                style += "z-index: 1000;";
            } else if (getMergedUnitDirection(unit) === "top") {

                style += "transform: translateY(20px);";
                style += "z-index: 1000;";


            } else if (getMergedUnitDirection(unit) === "right") {

                style += "transform: translateX(50%);";
                style += "left: 24%;"
                style += "z-index: 1000;";
            }
            else if (getMergedUnitDirection(unit) == 'left') {
                style += "transform: translateX(-50%);";
                style += "left: -24%;"
                style += "z-index: 1000;";

            }
            else {
                style = "none;";
            }

            return style;

        }
        function getUnitBorderStyle(unit) {
            const mergedUnitId = unit.mergedUnitId;
            const mergedUnit = selections
                .flatMap((floor) => floor.estateUnits)
                .find((u) => u.id === mergedUnitId);
            let style = "";

            if (mergedUnit) {
                const mergedUnitDirection = getMergedUnitDirection(mergedUnit);

                if (mergedUnitDirection === "bottom") {
                    style += "border-right: 1px solid #000;";
                    style += "border-left: 1px solid #000;";
                    style += "border-top: 1px solid #000;";
                    style += "border-bottom: 0px solid #fff;";
                    style += "border-top-left-radius: 0.5rem;";
                    style += "border-top-right-radius: 0.5rem;";
                    style += "border-bottom-left-radius: 0;";
                    style += "border-bottom-right-radius: 0;";
                    style += "margin: 5px 5px 0px 5px;";
                } else if (mergedUnitDirection === "top") {
                    style += "border-right: 1px solid #000;";
                    style += "border-left: 1px solid #000;";
                    style += "border-top: 0px solid #fff;";
                    style += "border-bottom: 1px solid #000;";
                    style += "border-bottom-left-radius: 0.5rem;";
                    style += "border-bottom-right-radius: 0.5rem;";
                    style += "border-top-left-radius: 0;";
                    style += "border-top-right-radius: 0;";
                    style += "margin: 0px 5px 5px 5px;";
                } else if (mergedUnitDirection === "right") {
                    style += "border-top: 1px solid #000;";
                    style += "border-right: 1px solid #000;";
                    style += "border-bottom: 1px solid #000;";
                    style += "border-left: 0px solid #fff;";
                    style += "border-top-left-radius: 0rem;";
                    style += "border-bottom-left-radius: 0rem;";
                    style += "margin: 5px 5px 5px 0px;";
                } else if (mergedUnitDirection === "left") {
                    style += "border-right: 0px solid #fff;";
                    style += "border-left: 1px solid #000;";
                    style += "border-top: 1px solid #000;";
                    style += "border-bottom: 1px solid #000;";
                    style += "border-top-right-radius: 0;";
                    style += "border-bottom-right-radius: 0;";
                    style += "border-top-left-radius: 0.5rem;";
                    style += "border-bottom-left-radius: 0.5rem;";
                    style += "margin: 5px 0px 5px 5px;";
                } else {
                    style = "none;";
                }
                return style;
            }

            if (getMergedUnitDirection(unit) === "bottom") {
                style += "border-right: 1px solid #000;";
                style += "border-left: 1px solid #000;";
                style += "border-top: 0px solid #fff;";
                style += "border-bottom: 1px solid #000;";
                style += "border-bottom-left-radius: 0.5rem;";
                style += "border-bottom-right-radius: 0.5rem;";
                style += "border-top-left-radius: 0;";
                style += "border-top-right-radius: 0;";
                style += "margin: 0px 5px 5px 5px;";
            } else if (getMergedUnitDirection(unit) === "top") {
                style += "border-right: 1px solid #000;";
                style += "border-left: 1px solid #000;";
                style += "border-top: 1px solid #000;";
                style += "border-bottom: 0px solid #fff;";
                style += "border-top-left-radius: 0.5rem;";
                style += "border-top-right-radius: 0.5rem;";
                style += "border-bottom-left-radius: 0;";
                style += "border-bottom-right-radius: 0;";
                style += "margin: 5px 5px 0px 5px;";
            } else if (getMergedUnitDirection(unit) === "right") {
                style += "border-right: 0px solid #fff;";
                style += "border-left: 1px solid #000;";
                style += "border-top: 1px solid #000;";
                style += "border-bottom: 1px solid #000;";
                style += "border-top-right-radius: 0;";
                style += "border-bottom-right-radius: 0;";
                style += "border-top-left-radius: 0.5rem;";
                style += "border-bottom-left-radius: 0.5rem;";
                style += "margin: 5px 0px 5px 5px;";
            } else if (getMergedUnitDirection(unit) === "left") {
                style += "border-top: 1px solid #000;";
                style += "border-right: 1px solid #000;";
                style += "border-bottom: 1px solid #000;";
                style += "border-left: 0px solid #fff;";
                style += "border-top-left-radius: 0rem;";
                style += "border-bottom-left-radius: 0rem;";
                style += "margin: 5px 5px 5px 0px;";
            } else {
                style = "none;";
            }

            return style;
        }

        function firstUnitStyle(item) {
            let style = "";



            if (item.isEmptyUnit == false) {
                if (item.floorNumber == 1) {
                    style += "background-color:rgba(100, 149, 237, 0.2);";

                } else {
                    style += "background-color: rgba(124, 252, 0, 0.2);";

                }


            }
            else if (item.isEmptyUnit == true) {
                if (item.floorNumber == 1) {
                    style += "background-color: rgba(255,192,203, 0.4); ";

                } else {
                    style += "background-color:  rgba(255,192,203, 0.4);";

                }


            }
            else {
                style += "none;";
            }

            return style;
        }

        function isUnitEmptyHandle(isEmpty) {
            if (isEmpty == true) {
                return '                    <div class="d-flex align-items-center"> < div class="mx-2" style = "height:15px;width:15px; background-color: lawngreen;opacity: 0.3;" > </div>< p class="mb-0" > واحد موجود < /p>< /div>'
            } else {
                return ' <div class="d-flex align-items-center"> < div class="mx-2" style = "height:15px;width:15px; background-color: cornflowerblue;opacity: 0.3;" > </div> < p > واحد فروخته شده < /p> < /div>'
            }
        }

        function isFloorTitleStyled(floor) {
            const findUnitInFloor = floor.estateUnits
                .filter((u) => u.floorNumber == floor.floorNumber);

            const UnitInFloor = findUnitInFloor.filter(a => a.mergedUnitId !== null)

            console.log(UnitInFloor)


            return ''
        }


        function updateSelectOptions() {


            $("#floors").empty();

            for (var i = selections.length - 1; i >= 0; i--) {
                $("#floors").append(
                    `<div class='floor-item col-10'>

                                                                                                                                                                                                                      <div class='unit-item-setting' style='${isFloorTitleStyled(selections[i])} ${selections[i]?.floorName.length >= 7 ? 'left: -40px;' : 'left: -26px;'} top: 10px' dir='rtl'>

                                                                                                                                                                                        <h6 class='text-success' style='font-size: 13px'>${selections[i]?.floorName || ''}</h6>

                                                                                                                                                                                      </div>
                                                                                                                                                                                              <div class='units-list'>
                                                                                                                                                                                      ${selections[
                        i
                    ].estateUnits
                        .map(
                            (
                                item
                            ) => `
                                                                                                                                                                                                <div class='unit-item position-relative py-2' id='unit-item${item.id
                                }' data-id='${item.id
                                }' style='${getUnitBorderStyle(
                                    item
                                ) +
                                firstUnitStyle(
                                    item
                                ) + 'height: 40px; padding: 0'
                                }'>
                                                                                                                                                                                                  <div class='d-flex position-relative flex-column' style='${getTextUnitStyle(item)}'>
                                                                                                                                                                                                                                    <h6 style='font-size: 12px' dir='rtl'>${!item.mergedUnitId && item.name + ' : ' + item.meterage + ' متر ' || ''} </h6>

                                                                                                                                                                                                  </div>

                                                                                                                                                                                                </div>

                                                                                                                                                                                            `
                        )
                        .join(
                            ""
                        )}

                                                                                                                                                                                      </div>
                                                                                                                                                                                    </div>`
                );
            }
        }

        $(document).ready(function () {
            var inputId = document.getElementById('id-edit-building');
            const imageRoof = document.getElementById('image-roof')
            const infoRoof = document.getElementById('info-roof')


            if (inputId.value) {

                $.ajax({
                    type: "POST",
                    url: '/Project/GetById?id=' + inputId.value,
                    contentType: false,
                    processData: false,
                    success: function (data) {


                        if (data.floors.length !== 0) {
                            imageRoof.style.display = 'block'
                            infoRoof.style.display = 'block'
                        }

                        data.floors.forEach(obj => {
                            var objectValues = Object.values(obj)
                            selections.push(obj)
                        })

                        updateSelectOptions()
                    },
                    error: (e) => {
                        console.log(e)
                    }
                });

                //const res = fetch()

            }
            KTDocsAdd.init();


        })
        $('.image-popup').magnificPopup({
            type: 'image',
            closeBtnInside: false,
            mainClass: 'mfp-with-zoom mfp-img-mobile',
            image: {
                verticalFit: true
            },
            gallery: {
                enabled: true // Enable gallery mode
            },
            callbacks: {
                open: function () {
                    // Enter full-screen mode
                    if (this.isFullScreen) {
                        this.close();
                        return;
                    }
                    this.isFullScreen = true;
                    this.wrap.addClass('mfp-full-screen');
                    this.wrap.on('click', '.mfp-close', function () {
                        $.magnificPopup.instance.close();
                    });
                },
                close: function () {
                    // Exit full-screen mode
                    this.isFullScreen = false;
                    this.wrap.removeClass('mfp-full-screen');
                    this.wrap.off('click', '.mfp-close');
                }
            }
        });


        var KTDocsAdd = function () {
            var map, marker = null;
            const locationChanged = function (e) {
                fetch(`https://api.neshan.org/v4/reverse?lat=${e.lat}&lng=${e.lng}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Api-Key': 'service.6JJqS1dMExBteluzRuL4zlIDzVXb7cieW2FO3SBI'
                    },
                }).then(response => response.json())
                    .then(result => {
                        document.getElementById('Lat').value = e.lat;
                        document.getElementById('Long').value = e.lng;
                        let addressElement = document.getElementById('Address');
                        addressElement.value = result.formatted_address;
                        //KTUtil.scrollTo(addressElement, 150);
                        //addressElement.focus();
                    }).catch(error => console.log(error));
            };


            return {
                init: function () {
                    const defaultLat = document.getElementById('Lat').value == '' ? 35.698367 : document.getElementById('Lat').value;
                    const defaultLng = document.getElementById('Long').value == '' ? 51.395378 : document.getElementById('Long').value;
                    map = new L.Map('map', {
                        key: 'web.DvgRmwDJDGt5lyqNPnYQ8FOkyIaofLrShHKDennS',
                        maptype: 'standard-day',
                        poi: true,
                        traffic: true,
                        center: [defaultLat, defaultLng],
                        zoom: 12
                    });
                    if (document.getElementById('Lat').value != '' && document.getElementById('Long').value != '') {
                        let latlng = new L.LatLng(defaultLat, defaultLng);
                        marker = L.marker(latlng)
                            .bindPopup(`<span class="font-sans-serif"><b>مختصات جغرافیایی:</b><br>${latlng.toString()}</span>`)
                            .addTo(map);
                        map.flyTo(latlng, 13);
                    }
                    //map.on('click', (e) => {
                    //    if (marker == null) {
                    //        marker = L.marker(e.latlng)
                    //            .bindPopup(`<span class="font-sans-serif"><b>مختصات جغرافیایی:</b><br>${e.latlng.toString()}</span>`)
                    //            .addTo(map);
                    //    } else {
                    //        marker.setLatLng(e.latlng);
                    //    }
                    //    map.flyTo(e.latlng, 13);
                    //    locationChanged(e.latlng);
                    //});
                }
            }
        }();

        $(document).ready(function () {

        });

        //var myMap = new L.Map('map', {
        //    key: 'web.7e9f4ee8e0054ed09d6bb46d53f8d96a',
        //    maptype: 'dreamy',
        //    poi: true,
        //    traffic: false,
        //    zoom: 14
        //});
        function getImageElement(image, id) {
            $('#big-image').attr('src', image);
        }
        var swiper = new Swiper('.swiper-container', {
            loop: true,
            slideToClickedSlide: true,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev'
            },
            scrollbar: {
                el: '.swiper-scrollbar'
            }
        });

                                                                                                        //var imageList = document.querySelectorAll('.image-click-list div img');
                                                                                                        //imageList.forEach(function (item) {
                                                                                                        //    item.addEventListener('click', function () {
                                                                                                        //        var id = this.parentElement.getAttribute('data-id');
                                                                                                        //        var slideIndex = getSlideIndexById(id);
                                                                                                        //        swiper.slideTo(slideIndex);
                                                                                                        //    });
                                                                                                        //});

                                                                                                        //swiper.on('slideChange', function () {
                                                                                                        //    var activeSlideIndex = swiper.realIndex;
                                                                                                        //    var activeSlide = swiper.slides[activeSlideIndex];
                                                                                                        //    var activeSlideId = activeSlide.getAttribute('data-id');
                                                                                                        //    setActiveImage(activeSlideId);
                                                                                                        //});

                                                                                                        //function setActiveImage(id) {
                                                                                                        //    var activeImage = document.querySelector('.image-click-list div[data-id="' + id + '"]');
                                                                                                        //    var activeImageSrc = activeImage.querySelector('img').getAttribute('src');
                                                                                                        //    var activeImages = document.querySelectorAll('.image-click-list div img');

                                                                                                        //    activeImages.forEach(function (image) {
                                                                                                        //        image.classList.remove('active');
                                                                                                        //    });

                                                                                                        //    activeImage.querySelector('img').classList.add('active');
                                                                                                        //}

                                                                                                        //function getSlideIndexById(id) {
                                                                                                        //    var slides = swiper.slides;
                                                                                                        //    for (var i = 0; i < slides.length; i++) {
                                                                                                        //        var slide = slides[i];
                                                                                                        //        var slideId = slide.getAttribute('data-id');
                                                                                                        //        if (slideId === id) {
                                                                                                        //            return i;
                                                                                                        //        }
                                                                                                        //    }
                                                                                                        //    return -1;
                                                                                                        //}

                                                                                                        //// Set the initial active image
                                                                                                        //setActiveImage(0);
    </script>
}